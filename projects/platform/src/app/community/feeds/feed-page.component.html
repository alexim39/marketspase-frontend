<div class="feed-page">
  
  <!-- Header -->
  <header class="feed-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">Community Feed</h1>
        <span class="live-badge" *ngIf="posts().length > 0">
          <span class="live-dot"></span>
          {{ posts().length }} posts
        </span>
      </div>
      
      <div class="header-actions">
        <button 
          mat-icon-button 
          class="refresh-btn"
          (click)="onRefresh()"
          [disabled]="loading()"
          matTooltip="Refresh feed">
          <mat-icon>refresh</mat-icon>
        </button>
        
        <button 
          mat-raised-button 
          color="primary"
          class="create-post-btn"
          (click)="onCreatePost()">
          <mat-icon>add</mat-icon>
          <span>Create Post</span>
        </button>
      </div>
    </div>
    
    <!-- Search Bar -->
    <div class="search-bar">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        placeholder="Search posts, people, or hashtags..."
        (input)="onSearch($any($event.target).value)"
        class="search-input">
    </div>
    
    <!-- Tabs -->
    <mat-tab-group 
      [selectedIndex]="selectedTab() === 'all' ? 0 : selectedTab() === 'trending' ? 1 : selectedTab() === 'following' ? 2 : 3"
      (selectedIndexChange)="onTabChange($any($event) === 0 ? 'all' : $any($event) === 1 ? 'trending' : $any($event) === 2 ? 'following' : 'saved')"
      class="feed-tabs">
      <mat-tab label="For You"></mat-tab>
      <mat-tab label="Trending"></mat-tab>
      <mat-tab label="Following"></mat-tab>
      <mat-tab label="Saved"></mat-tab>
    </mat-tab-group>
    
    <!-- Filters -->
    <div class="filters-wrapper" [class.expanded]="showFilters()">
      <button 
        class="filter-toggle"
        (click)="showFilters.set(!showFilters())">
        <mat-icon>tune</mat-icon>
        <span>Filters</span>
        <mat-icon class="chevron">
          {{ showFilters() ? 'expand_less' : 'expand_more' }}
        </mat-icon>
      </button>
      
      <div class="filters-content" *ngIf="showFilters()">
        <div class="filter-group">
          <label>Post Type</label>
          <div class="filter-chips">
            <button 
              class="filter-chip" 
              [class.active]="selectedType() === 'all'"
              (click)="onTypeChange('all')">
              All
            </button>
            <button 
              class="filter-chip" 
              [class.active]="selectedType() === 'earnings'"
              (click)="onTypeChange('earnings')">
              <mat-icon>emoji_events</mat-icon>
              Earnings
            </button>
            <button 
              class="filter-chip" 
              [class.active]="selectedType() === 'campaign'"
              (click)="onTypeChange('campaign')">
              <mat-icon>campaign</mat-icon>
              Campaigns
            </button>
            <button 
              class="filter-chip" 
              [class.active]="selectedType() === 'question'"
              (click)="onTypeChange('question')">
              <mat-icon>help</mat-icon>
              Questions
            </button>
            <button 
              class="filter-chip" 
              [class.active]="selectedType() === 'tip'"
              (click)="onTypeChange('tip')">
              <mat-icon>lightbulb</mat-icon>
              Tips
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Main Content -->
  <main class="feed-content" #feedContainer>
    
    <!-- Trending Hashtags -->
    <div class="trending-section" *ngIf="trendingHashtags().length > 0">
      <h3 class="section-title">
        <mat-icon>trending_up</mat-icon>
        Trending Hashtags
      </h3>
      <div class="hashtags-list">
        <button 
          *ngFor="let hashtag of trendingHashtags()"
          class="hashtag-chip"
          (click)="onHashtagClick(hashtag.tag)">
          <span class="hash">#</span>{{ hashtag.tag }}
          <span class="count">{{ hashtag.count }}</span>
        </button>
      </div>
    </div>
    
    <!-- Feed Posts -->
    <div 
      class="feed-posts"
      [@feedAnimation]="filteredPosts().length">
      
      <!-- Featured Post -->
      <div class="featured-post" *ngIf="featuredPost() as post">
        <div class="featured-badge">
          <mat-icon>stars</mat-icon>
          <span>Featured Post</span>
        </div>
        
        <app-feed-post-card
          [post]="post"
          [isLiked]="likedPosts().has(post._id)"
          [isSaved]="savedPosts().has(post._id)"
          (like)="onLike(post)"
          (save)="onSave(post._id)"
          (comment)="onComment(post._id)"
          (share)="onShare(post)"
          (hashtagClick)="onHashtagClick($event)">
        </app-feed-post-card>
      </div>
      
      <!-- Regular Posts -->
      <div class="posts-grid">
        <app-feed-post-card
          *ngFor="let post of regularPosts();"
          [post]="post"
          [isLiked]="likedPosts().has(post._id)"
          [isSaved]="savedPosts().has(post._id)"
          (like)="onLike(post)"
          (save)="onSave(post._id)"
          (comment)="onComment(post._id)"
          (share)="onShare(post)"
          (hashtagClick)="onHashtagClick($event)">
        </app-feed-post-card>
      </div>
      
      <!-- Loading Indicator -->
      <div class="loading-container" *ngIf="loading()">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      
      <!-- Scroll Anchor -->
      <div #scrollAnchor class="scroll-anchor"></div>
      
      <!-- Empty State -->
      <div class="empty-state" *ngIf="!loading() && filteredPosts().length === 0">
        <div class="empty-icon">
          <mat-icon>forum</mat-icon>
        </div>
        <h3>No posts found</h3>
        <p>Be the first to share something with the community!</p>
        <button 
          mat-raised-button 
          color="primary"
          (click)="onCreatePost()">
          Create Post
        </button>
      </div>
      
      <!-- End of Feed -->
      <div class="end-feed" *ngIf="!hasMore() && filteredPosts().length > 0">
        <mat-divider></mat-divider>
        <p>You've reached the end! ðŸŽ‰</p>
      </div>
    </div>
    
  </main>
  
  <!-- Floating Action Button (Mobile) -->
  <button 
    class="fab-mobile"
    mat-fab
    color="primary"
    (click)="onCreatePost()"
    *ngIf="(posts().length > 0)">
    <mat-icon>add</mat-icon>
  </button>
  
</div>