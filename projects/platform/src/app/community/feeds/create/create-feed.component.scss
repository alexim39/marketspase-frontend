@import '../../../../styles/variables';
@import '../../../../styles/mixins';

// Shared mixins for common patterns
@mixin icon-button($size: 40px) {
  @include flex-center;
  width: $size;
  height: $size;
  border: none;
  border-radius: $border-radius-full;
  cursor: pointer;
  transition: all $transition-fast;
}

@mixin step-container-base {
  background: $surface-color;
  border-radius: $border-radius-xl;
  border: $border-width solid $border-color;
  overflow: hidden;
}

@mixin chip-base {
  padding: $spacing-1 $spacing-2;
  border-radius: $border-radius-xl;
  font-size: $font-size-xs;
}

.create-feed-page {
  min-height: 100vh;
  background: $background-color;
  color: $text-primary;
  
  // Page Header
  .page-header {
    position: sticky;
    top: 0;
    z-index: $z-index-sticky;
    border-bottom: $border-width solid $border-color;
    backdrop-filter: blur(8px);
    background: rgba($surface-color, 0.95);

   
    
    .header-content {
      @include flex-between;
      padding: $spacing-4 $spacing-6;
      max-width: 1400px;
      margin: 0 auto;
      
      .back-btn, .preview-toggle {
        @include icon-button;
        background: $background-color;
        color: $text-secondary;
        
        &:hover {
          background: $primary-color;
          color: $white;
        }
      }
      
      .back-btn:hover {
        transform: translateX(-2px);
      }
      
      .header-title {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: $spacing-3;
        
        h1 {
          @include heading-small;
          margin: 0;
          
          @include tablet {
            font-size: $font-size-3xl;
          }
        }

         p {
          font-size: 0.95rem;
          color: $text-secondary;
          display: inline-block;
          @include mobile {
            font-size: 0.75rem;
            width: 20em;
          }
        }
        
        .step-indicator {
          @include chip-base;
          background: $background-color;
          color: $text-secondary;
        }
      }
      
      .header-actions {
        display: flex;
        gap: $spacing-2;
        
        .save-draft-btn {
          @include button-secondary;
          border-radius: $border-radius-xl;
          
          mat-icon {
            font-size: $font-size-lg;
          }
        }
      }
    }
    
    .progress-bar {
      height: 4px;
      background: $border-color;
      width: 100%;
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, $primary-color, $secondary-color);
        transition: width $transition-normal;
        border-radius: 0 $border-radius-full $border-radius-full 0;
      }
    }
  }
  
  // Main Content Layout
  .main-content {
    display: flex;
    max-width: 1400px;
    margin: 0 auto;
    padding: $spacing-6;
    gap: $spacing-6;

    &.with-preview {
      flex-direction: row;

      .form-section {
        flex: 1;
        max-width: 60%;
      }
      
      .preview-section {
        flex: 1;
        max-width: 40%;
      }

      @media (max-width: 768px) {
        flex-direction: column-reverse;

        .form-section, 
        .preview-section {
          max-width: 100%;
          width: 100%;
        }
      }
    }
    
    // Form Section Components
    .form-section {
      flex: 1;
      
      .step-container {
        @include step-container-base;
        margin-bottom: $spacing-6;
        
        .step-header {
          padding: $spacing-6;
          background-color: $background-color;
          border-bottom: $border-width solid $border-color;
          display: flex;
          align-items: center;
          gap: $spacing-4;
          
          .step-number {
            @include icon-button(40px);
            background: $primary-color;
            color: $white;
            font-weight: $font-weight-bold;
            font-size: $font-size-lg;
          }
          
          h2 {
            @include body-large;
            font-weight: $font-weight-semibold;
            margin: 0;
            color: $text-primary;
          }
        }
        
        .step-content {
          padding: $spacing-6;
          
          // Post Type Field
          .post-type-field {
            width: 100%;
            margin-bottom: $spacing-6;
            
            .option-content {
              display: flex;
              align-items: center;
              gap: $spacing-3;
              padding: $spacing-2 0;
              
              mat-icon { color: $primary-color; }
              
              .option-title {
                font-weight: $font-weight-medium;
                color: $text-primary;
              }
              
              .option-desc {
                font-size: $font-size-xs;
                color: $text-secondary;
              }
            }
          }
          
          // Suggestions
          .suggestions-section {
            margin-bottom: $spacing-6;
            
            h3 {
              @include body-small;
              font-weight: $font-weight-medium;
              color: $text-secondary;
              margin: 0 0 $spacing-3;
            }
            
            .suggestions-list {
              display: flex;
              flex-wrap: wrap;
              gap: $spacing-2;
              
              .suggestion-chip {
                display: flex;
                align-items: center;
                gap: $spacing-1;
                padding: $spacing-2 $spacing-3;
                background: $background-color;
                border: $border-width solid $border-color;
                border-radius: $border-radius-xl;
                color: $text-secondary;
                font-size: $font-size-sm;
                cursor: pointer;
                transition: all $transition-fast;
                
                mat-icon {
                  font-size: $font-size-base;
                  color: $primary-color;
                }
                
                &:hover {
                  border-color: $primary-color;
                  background: rgba($primary-rgb, 0.02);
                  color: $primary-color;
                  transform: translateY(-2px);
                }
              }
            }
          }
          
          // Content Input
          .content-input-wrapper {
            position: relative;
            margin-bottom: $spacing-4;
            
            .content-field {
              width: 100%;
              
              textarea {
                resize: vertical;
                min-height: 200px;
              }
              
              .limit-warning { color: $warning-color; }
            }
            
            .quick-actions {
              position: absolute;
              bottom: $spacing-3;
              right: $spacing-3;
              display: flex;
              gap: $spacing-1;
              background: $surface-color;
              border: $border-width solid $border-color;
              border-radius: $border-radius-xl;
              padding: $spacing-1;
              
              .action-btn {
                @include icon-button(32px);
                background: none;
                color: $text-secondary;
                
                &:hover {
                  background: rgba($primary-rgb, 0.1);
                  color: $primary-color;
                }
              }
            }
          }
          
          // Media Grid
          .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: $spacing-3;
            margin: $spacing-4 0;
            
            .media-item {
              position: relative;
              aspect-ratio: 1;
              border-radius: $border-radius-lg;
              overflow: hidden;
              border: $border-width solid $border-color;
              
              img, .video-placeholder {
                width: 100%;
                height: 100%;
                object-fit: cover;
              }
              
              .video-placeholder {
                background: $background-color;
                @include flex-center;
                
                mat-icon {
                  font-size: $font-size-4xl;
                  color: $primary-color;
                  opacity: 0.7;
                }
              }
              
              .remove-media {
                @include icon-button(24px);
                position: absolute;
                top: $spacing-1;
                right: $spacing-1;
                background: rgba($error-color, 0.9);
                color: $white;
                opacity: 0;
                
                mat-icon { font-size: $font-size-base; }
                
                &:hover { opacity: 1; }
              }
              
              .file-name {
                @include text-ellipsis;
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                padding: $spacing-1;
                background: rgba($black, 0.7);
                color: $white;
                font-size: $font-size-xs;
                text-align: center;
              }
            }
          }
          
          // Hashtags Section
          .hashtags-section {
            margin-top: $spacing-6;
            
            .hashtags-header {
              display: flex;
              align-items: center;
              gap: $spacing-2;
              margin-bottom: $spacing-3;
              
              mat-icon { color: $primary-color; }
              
              span {
                font-weight: $font-weight-medium;
                color: $text-primary;
              }
            }
            
            .hashtags-input {
              display: flex;
              gap: $spacing-2;
              margin-bottom: $spacing-3;
              
              .hashtag-field { flex: 1; }
              
              .add-hashtag-btn {
                @include button-primary;
                padding: $spacing-2 $spacing-4;
                border-radius: $border-radius;
                height: 56px;
              }
            }
            
            .hashtags-list {
              display: flex;
              flex-wrap: wrap;
              gap: $spacing-2;
              margin-bottom: $spacing-3;
              
              .hashtag-chip {
                display: flex;
                align-items: center;
                gap: $spacing-1;
                padding: $spacing-1 $spacing-2;
                background: rgba($primary-rgb, 0.1);
                border-radius: $border-radius-xl;
                color: $primary-color;
                font-size: $font-size-sm;
                
                .remove-hashtag {
                  @include icon-button(18px);
                  background: none;
                  color: currentColor;
                  
                  &:hover {
                    background: rgba($error-color, 0.2);
                    color: $error-color;
                  }
                  
                  mat-icon { font-size: $font-size-xs; }
                }
              }
            }
            
            .suggested-hashtags {
              display: flex;
              flex-wrap: wrap;
              align-items: center;
              gap: $spacing-2;
              
              .label {
                font-size: $font-size-xs;
                color: $text-tertiary;
              }
              
              .suggested-tag {
                @include chip-base;
                padding: $spacing-1 $spacing-2;
                background: $background-color;
                border: $border-width dashed $border-color;
                color: $text-secondary;
                cursor: pointer;
                transition: all $transition-fast;
                
                &:hover {
                  border-color: $primary-color;
                  color: $primary-color;
                }
              }
            }
          }
          
          // Common field containers
          .type-fields, .selected-campaign-preview, .post-summary {
            background: $background-color;
            border-radius: $border-radius-lg;
            border: $border-width solid $border-color;
          }
          
          .type-fields {
            padding: $spacing-4;
            margin-bottom: $spacing-6;
            
            .fields-title {
              @include body-small;
              font-weight: $font-weight-semibold;
              color: $text-primary;
              margin: 0 0 $spacing-4;
              padding-bottom: $spacing-2;
              border-bottom: $border-width solid $border-color;
            }
            
            .row {
              display: flex;
              gap: $spacing-3;
              margin-bottom: $spacing-3;
              
              .flex-1 { flex: 1; }
              .flex-2 { flex: 2; }
            }
            
            .full-width { width: 100%; margin-bottom: $spacing-3; }
            
          }

          .select-campaign { width: 100% !important; }
          
          // Post Summary
          .post-summary {
            padding: $spacing-4;
            margin-bottom: $spacing-6;
            
            .summary-header {
              display: flex;
              align-items: center;
              gap: $spacing-2;
              margin-bottom: $spacing-4;
              
              mat-icon { color: $primary-color; }
              
              h3 {
                @include body-small;
                font-weight: $font-weight-semibold;
                margin: 0;
                color: $text-primary;
              }
            }
            
            .summary-content {
              display: flex;
              flex-direction: column;
              gap: $spacing-3;
              
              .summary-item {
                display: flex;
                padding: $spacing-2 0;
                border-bottom: $border-width dashed $border-color;
                
                &:last-child { border-bottom: none; }
                
                .summary-label {
                  width: 100px;
                  font-size: $font-size-sm;
                  color: $text-secondary;
                }
                
                .summary-value {
                  flex: 1;
                  font-size: $font-size-sm;
                  color: $text-primary;
                  display: flex;
                  align-items: center;
                  gap: $spacing-1;
                  
                  mat-icon {
                    font-size: $font-size-base;
                    color: $primary-color;
                  }
                  
                  &.highlight { color: $success-color; font-weight: $font-weight-semibold; }
                  
                  .milestone {
                    font-size: $font-size-xs;
                    color: $text-tertiary;
                    font-weight: $font-weight-normal;
                  }
                  
                  .summary-hashtag {
                    color: $primary-color;
                    margin-right: $spacing-1;
                    &::before { content: '#'; }
                  }
                  
                  .text-muted { color: $text-tertiary; }
                }
              }
            }
          }
          
          // Tips Section
          .tips-section {
            display: flex;
            gap: $spacing-3;
            padding: $spacing-4;
            background: rgba($primary-rgb, 0.05);
            border-radius: $border-radius-lg;
            margin-bottom: $spacing-6;
            
            .tips-icon { color: $primary-color; }
            
            .tips-content {
              h4 {
                @include body-small;
                font-weight: $font-weight-semibold;
                color: $text-primary;
                margin: 0 0 $spacing-2;
              }
              
              ul {
                margin: 0;
                padding-left: $spacing-4;
                
                li {
                  font-size: $font-size-sm;
                  color: $text-secondary;
                  margin-bottom: $spacing-1;
                }
              }
            }
          }
        }
      }
      
      // Step Navigation
      .step-navigation {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: $spacing-6;
        
        .nav-btn {
          display: flex;
          align-items: center;
          gap: $spacing-2;
          padding: $spacing-3 $spacing-6;
          border: $border-width solid $border-color;
          background: $surface-color;
          color: $text-primary;
          border-radius: $border-radius-xl;
          font-weight: $font-weight-medium;
          cursor: pointer;
          transition: all $transition-fast;
          
          &:hover:not(:disabled) {
            border-color: $primary-color;
            color: $primary-color;
          }
          
          &:disabled {
            opacity: 0.5;
            cursor: not-allowed;
          }
          
          &.next {
            background: $primary-color;
            color: $white;
            border-color: $primary-color;
            
            &:hover:not(:disabled) {
              background: $primary-dark;
              transform: translateX(2px);
            }
          }
          
          &.publish {
            background: $success-color;
            color: $white;
            border-color: $success-color;
            
            mat-spinner { display: inline-block; margin-right: $spacing-2; }
            
            &:hover:not(:disabled) {
              background: darken($success-color, 5%);
              transform: translateY(-2px);
              box-shadow: $shadow-md;
            }
          }
        }
        
        .step-dots {
          display: flex;
          gap: $spacing-2;
          
          .step-dot {
            width: 10px;
            height: 10px;
            border: none;
            border-radius: $border-radius-full;
            background: $border-color;
            cursor: pointer;
            transition: all $transition-fast;
            padding: 0;
            
            &.active {
              background: $primary-color;
              transform: scale(1.3);
            }
            
            &.completed { background: $success-color; }
            
            &:hover {
              background: $primary-color;
              opacity: 0.7;
            }
          }
        }
      }
    }
    
    // Preview Section
    .preview-section {
      @include step-container-base;
      height: fit-content;
      position: sticky;
      top: 100px;
      
      .preview-header {
        @include flex-between;
        padding: $spacing-4 $spacing-6;
        border-bottom: $border-width solid $border-color;
        
        h3 {
          @include body-medium;
          font-weight: $font-weight-semibold;
          margin: 0;
          color: $text-primary;
        }
        
        .close-preview {
          @include icon-button(32px);
          background: $background-color;
          color: $text-secondary;
          
          &:hover {
            background: $error-color;
            color: $white;
          }
        }
      }
      
      .preview-content {
        padding: $spacing-6;
        max-height: 60vh;
        overflow-y: auto;
        
        &::-webkit-scrollbar {
          width: 6px;
          
          &-track { background: $background-color; }
          &-thumb {
            background: $text-tertiary;
            border-radius: $border-radius-full;
          }
        }
      }
      
      .preview-tips {
        display: flex;
        align-items: center;
        gap: $spacing-2;
        padding: $spacing-3 $spacing-6;
        background: rgba($info-color, 0.1);
        border-top: $border-width solid $border-color;
        font-size: $font-size-xs;
        color: $text-secondary;
        
        mat-icon {
          font-size: $font-size-base;
          color: $info-color;
        }
      }
    }
  }
  
  // Campaign Option Styling
// Campaign option styling
.campaign-option {
  display: flex;
  align-items: center;
  gap: $spacing-3;
  padding: $spacing-1 0;
  width: 100%;
  
  .campaign-title {
    flex: 2;
    font-weight: $font-weight-medium;
    color: $text-primary;
  }
  
  .campaign-status {
    flex: 1;
    font-size: $font-size-xs;
    padding: $spacing-1 $spacing-2;
    border-radius: $border-radius-xl;
    text-transform: capitalize;
    
    &.active {
      background: rgba($success-color, 0.1);
      color: $success-color;
    }
    
    &.completed {
      background: rgba($primary-color, 0.1);
      color: $primary-color;
    }
    
    &.paused {
      background: rgba($warning-color, 0.1);
      color: $warning-color;
    }
  }
  
  .campaign-progress {
    flex: 1;
    font-size: $font-size-xs;
    color: $text-secondary;
  }
}
  
  // Selected Campaign Preview
  .selected-campaign-preview {
    display: flex;
    gap: $spacing-4;
    padding: $spacing-4;
    margin-top: $spacing-4;
    
    .campaign-media {
      width: 120px;
      height: 120px;
      border-radius: $border-radius-lg;
      overflow: hidden;
      background: $surface-color;
      
      img { width: 100%; height: 100%; object-fit: cover; }
      
      .video-placeholder {
        width: 100%;
        height: 100%;
        @include flex-center;
        flex-direction: column;
        gap: $spacing-1;
        background: $surface-color;
        color: $primary-color;
        
        mat-icon { font-size: $font-size-4xl; }
        span { font-size: $font-size-xs; color: $text-secondary; }
      }
    }
    
    .campaign-details {
      flex: 1;
      
      h4 {
        @include body-medium;
        font-weight: $font-weight-semibold;
        margin: 0 0 $spacing-2;
        color: $text-primary;
      }
      
      .campaign-stats {
        display: flex;
        gap: $spacing-4;
        
        .stat {
          .label {
            font-size: $font-size-xs;
            color: $text-tertiary;
            display: block;
          }
          
          .value {
            font-size: $font-size-base;
            font-weight: $font-weight-medium;
            color: $text-primary;
          }
        }
      }
    }
  }
  
  // Publish Section
  .publish-section {
    margin-top: $spacing-6;
    text-align: center;
    
    .publish-btn {
      @include button-primary;
      padding: $spacing-3 $spacing-8;
      border-radius: $border-radius-xl;
      font-size: $font-size-lg;
      min-width: 300px;
      
      mat-spinner { display: inline-block; margin-right: $spacing-2; }
      
      &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
    }
    
    .validation-message {
      margin-top: $spacing-3;
      color: $warning-color;
      font-size: $font-size-sm;
      
      p { margin: $spacing-1 0; }
    }
  }
  
  // Post Options
  .post-options {
    display: flex;
    gap: $spacing-4;
    margin-top: $spacing-4;
    padding: $spacing-4;
    background: $background-color;
    border-radius: $border-radius-lg;
    border: $border-width solid $border-color;
  }
  
  // Dark Mode
  [data-theme="dark"] & {
    .page-header { background: rgba($gray-900, 0.95); }
    .step-header { background-color: $background-color; }
    .media-item .file-name { background: rgba($black, 0.8); }
    .option-card:hover { background: rgba($primary-rgb, 0.05); }
  }
  
  // Responsive
  @include tablet {
    .main-content {
      flex-direction: column;
      
      &.with-preview {
        .form-section, .preview-section { max-width: 100%; }
        .preview-section { position: static; }
      }
    }
  }
  
  @include mobile {
    .page-header .header-content {
      padding: $spacing-3 $spacing-4;
      
      .header-title {
        h1 { font-size: $font-size-xl; }
        .step-indicator { display: none; }
      }
      
      .header-actions .save-draft-btn span { display: none; }
    }
    
    .main-content {
      padding: $spacing-4;
      
      .form-section .step-container {
        .step-header {
          padding: $spacing-4;
          
          .step-number {
            width: 32px;
            height: 32px;
            font-size: $font-size-base;
          }
          
          h2 { font-size: $font-size-base; }
        }
        
        .step-content { padding: $spacing-4; }
      }
      
      .selected-campaign-preview {
        flex-direction: column;
        
        .campaign-media {
          width: 100%;
          height: 200px;
        }
        
        .campaign-stats { flex-wrap: wrap; }
      }
      
      .publish-btn {
        width: 100%;
        min-width: unset !important;
      }
      
      .post-options {
        flex-direction: column;
        gap: $spacing-2;
      }
    }
  }
}