<!-- components/store-create/store-create.component.html -->
<div class="store-create">
  <div class="create-container">
    <!-- Header -->
    <div class="create-header">
      <button mat-icon-button class="back-button" (click)="onCancel()" [disabled]="isSubmitting()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-content">
        <h1>Create New Store</h1>
        <p>Set up your virtual store to start selling and promoting products</p>
      </div>
    </div>

    <!-- Progress Bar -->
    @if (isSubmitting()) {
      <div class="loading-overlay">
        <mat-card class="loading-card">
          <mat-card-content>
            <div class="loading-content">
              <!-- <mat-spinner diameter="40" color="primary"></mat-spinner> -->
               <mat-progress-bar mode="indeterminate"></mat-progress-bar>
              <div class="loading-text">
                <h3>Creating Your Store...</h3>
                <p>Please wait while we set up your store. This may take a moment.</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    }

    <!-- Main Form -->
    <form [formGroup]="storeForm" (ngSubmit)="onSubmit()" class="store-form" [class.form-loading]="isSubmitting()">
      <div class="form-grid">
        <!-- Left Column -->
        <div class="form-left">
          <!-- Store Name -->
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>storefront</mat-icon>
                Store Information
              </mat-card-title>
              <mat-card-subtitle>Basic details about your store</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Store Name</mat-label>
                <input matInput formControlName="name" placeholder="Enter your store name" maxlength="50">
                <mat-icon matSuffix>badge</mat-icon>
                <mat-hint align="end">{{ nameLength() }}/50</mat-hint>
                <mat-error *ngIf="isFieldInvalid('name')">
                  {{ getFieldError('name') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Category</mat-label>
                <mat-select formControlName="category" placeholder="Select store category">
                  @for (category of categories; track category.value) {
                    <mat-option [value]="category.value">{{category.label}}</mat-option>
                  }
                </mat-select> 
                <mat-icon matSuffix>category</mat-icon>
                <mat-error *ngIf="isFieldInvalid('category')">
                  {{ getFieldError('category') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Store Description</mat-label>
                <textarea matInput formControlName="description" placeholder="Describe what your store offers..." 
                         rows="4" maxlength="500"></textarea>
                <mat-hint align="end">{{ descriptionLength() }}/500</mat-hint>
                <mat-error *ngIf="isFieldInvalid('description')">
                  {{ getFieldError('description') }}
                </mat-error>
              </mat-form-field>
            </mat-card-content>
          </mat-card>

          <!-- Contact Information -->
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>contact_phone</mat-icon>
                Contact Information
              </mat-card-title>
              <mat-card-subtitle>How customers can reach you</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>WhatsApp Business Number</mat-label>
                <input matInput formControlName="whatsappNumber" placeholder="e.g., 08012345678 or +2348012345678">
                <mat-icon matSuffix>whatsapp</mat-icon>
                <mat-hint>Enter your Nigerian WhatsApp business number</mat-hint>
                <mat-error *ngIf="isFieldInvalid('whatsappNumber')">
                  {{ getFieldError('whatsappNumber') }}
                </mat-error>
              </mat-form-field>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Right Column -->
        <div class="form-right">
          <!-- Store Logo -->
          <mat-card class="form-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>image</mat-icon>
                Store Logo
              </mat-card-title>
              <mat-card-subtitle>Upload your store logo (optional)</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="logo-upload-section">
                <!-- Logo Preview -->
                @if (previewImage()) {
                  <div class="logo-preview">
                    <img [src]="previewImage()" alt="Store logo preview" class="logo-image">
                    <button mat-icon-button class="remove-logo" (click)="removeLogo()" type="button">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                } @else {
                  <div class="logo-placeholder">
                    <mat-icon class="placeholder-icon">storefront</mat-icon>
                    <p>No logo uploaded</p>
                  </div>
                }

                <!-- Upload Button -->
                <div class="upload-actions">
                  <input type="file" id="logoUpload" accept="image/*" (change)="onFileSelected($event)" class="file-input" hidden>
                  <label for="logoUpload" class="upload-button">
                    <mat-icon>cloud_upload</mat-icon>
                    <span>{{ previewImage() ? 'Change Logo' : 'Upload Logo' }}</span>
                  </label>
                  
                  @if (previewImage()) {
                    <button mat-button type="button" (click)="removeLogo()" class="remove-button">
                      <mat-icon>delete</mat-icon>
                      Remove
                    </button>
                  }
                </div>

                <div class="upload-hint">
                  <p>Recommended: Square image, 500Ã—500px, JPG/PNG/WEBP</p>
                  <p>Max file size: 5MB</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Store Preview -->
          <mat-card class="form-section preview-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>visibility</mat-icon>
                Store Preview
              </mat-card-title>
              <mat-card-subtitle>How your store will appear</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="store-preview">
                <div class="preview-header">
                  @if (previewImage()) {
                    <img [src]="previewImage()" alt="Store logo" class="preview-logo">
                  } @else {
                    <div class="preview-logo-placeholder">
                      <mat-icon>storefront</mat-icon>
                    </div>
                  }
                  <div class="preview-info">
                    <h3>{{ storeForm.value.name || 'Your Store Name' }}</h3>
                    <p>{{ storeForm.value.category || 'Store Category' }}</p>
                  </div>
                </div>
                <div class="preview-description">
                  {{ storeForm.value.description || 'Store description will appear here...' }}
                </div>
                <div class="preview-contact">
                  <mat-icon>phone</mat-icon>
                  <span>{{ storeForm.value.whatsappNumber || user()?.personalInfo?.phone || 'No WhatsApp number' }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Form Actions -->
          <div class="form-actions">
            <button mat-button type="button" (click)="onCancel()" [disabled]="isSubmitting()" class="cancel-button">
              <mat-icon>cancel</mat-icon>
              Cancel
            </button>
            
            <button mat-raised-button color="primary" type="submit" 
                    [disabled]="storeForm.invalid || isSubmitting()" 
                    class="submit-button">
              @if (isSubmitting()) {
                <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
              } @else {
                <mat-icon>add_business</mat-icon>
              }
              {{ isSubmitting() ? 'Creating...' : 'Create Store' }}
            </button>

          </div>
        </div>
      </div>
    </form>

    <!-- Help Section -->
    <mat-card class="help-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>help</mat-icon>
          Need Help?
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="help-content">
          <div class="help-item">
            <mat-icon>info</mat-icon>
            <div class="help-text">
              <h4>Store Name Tips</h4>
              <p>Choose a memorable name that reflects your brand and is easy to spell.</p>
            </div>
          </div>
          <div class="help-item">
            <mat-icon>description</mat-icon>
            <div class="help-text">
              <h4>Description Guidelines</h4>
              <p>Clearly describe what you sell and what makes your store unique.</p>
            </div>
          </div>
          <div class="help-item">
            <mat-icon>phone</mat-icon>
            <div class="help-text">
              <h4>WhatsApp Business</h4>
              <p>Use a dedicated WhatsApp Business number for customer inquiries and orders.</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>