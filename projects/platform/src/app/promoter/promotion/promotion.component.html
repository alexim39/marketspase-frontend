<div class="promoter-campaigns-container">
  <app-header title="My Promotions"/>

  <main class="content-container">
    <div class="container">
      @if (deviceType() === 'desktop') {
      <app-stats-overview [stats]="stats()"/>
      }
      @if (deviceType() === 'mobile') {
      <app-stats-overview-mobile [stats]="stats()"/>
      }
      
      <div class="campaign-list-section">
        <nav mat-tab-nav-bar [tabPanel]="tabPanel">
          <a mat-tab-link [active]="selectedTab() === 'all'" (click)="onTabChange('all')">All Promotions ({{ stats().total }})</a>
          <a mat-tab-link [active]="selectedTab() === 'pending'" (click)="onTabChange('pending')">Pending ({{ stats().pending }})</a>
          <a mat-tab-link [active]="selectedTab() === 'submitted'" (click)="onTabChange('submitted')">Submitted ({{ stats().submitted }})</a>
          <a mat-tab-link [active]="selectedTab() === 'validated'" (click)="onTabChange('validated')">Validated ({{ stats().validated }})</a>
          <a mat-tab-link [active]="selectedTab() === 'paid'" (click)="onTabChange('paid')">Paid ({{ stats().paid }})</a>
          <a mat-tab-link [active]="selectedTab() === 'rejected'" (click)="onTabChange('rejected')">Rejected ({{ stats().rejected }})</a>
        </nav>

        <mat-tab-nav-panel #tabPanel></mat-tab-nav-panel>

        @if (isLoading()) {
          <app-loading-state />
        } @else {
          @if (isEmptyState()) {
            <app-empty-state />
          } @else {
            <div class="promotions-list">
              @for (promotion of filteredPromotions(); track promotion._id) {
                <app-promotion-card
                  [promotion]="promotion"
                  (openSubmitDialog)="openSubmitProofDialog($event)"
                />
              }
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-container">
              <!-- Desktop Pagination -->
              <!-- @if (deviceType() === 'desktop' && pagination().totalPages > 1) {
                <mat-paginator
                  [length]="pagination().total"
                  [pageSize]="pagination().limit"
                  [pageIndex]="pagination().page - 1"
                  [pageSizeOptions]="[12, 24, 48, 96]"
                  (page)="onPageChange($event)"
                  aria-label="Select page">
                </mat-paginator>
              } -->

              @if (deviceType() === 'desktop' && hasMoreData()) {
                <div class="load-more-mobile">
                  <button 
                    mat-stroked-button 
                    (click)="loadMorePromotions()"
                    [disabled]="isLoadingMore()"
                    class="load-more-btn">
                    @if (isLoadingMore()) {
                      <div class="button-content">
                        <mat-progress-spinner diameter="16" mode="indeterminate" strokeWidth="2"></mat-progress-spinner>
                        <span class="button-text">Loading...</span>
                      </div>
                    } @else {
                      <div class="button-content">
                        <mat-icon>expand_more</mat-icon>
                        <span class="button-text">Load More</span>
                      </div>
                    }
                  </button>
                </div>
              }

              <!-- Mobile Load More -->
              @if (deviceType() === 'mobile' && hasMoreData()) {
                <div class="load-more-mobile">
                  <button 
                    mat-stroked-button 
                    (click)="loadMorePromotions()"
                    [disabled]="isLoadingMore()"
                    class="load-more-btn">
                    @if (isLoadingMore()) {
                      <div class="button-content">
                        <mat-progress-spinner diameter="16" mode="indeterminate" strokeWidth="2"></mat-progress-spinner>
                        <span class="button-text">Loading...</span>
                      </div>
                    } @else {
                      <div class="button-content">
                        <mat-icon>expand_more</mat-icon>
                        <span class="button-text">Load More</span>
                      </div>
                    }
                  </button>
                </div>
              }

              <!-- Results Info -->
              <div class="results-info">
                @if (deviceType() === 'desktop') {
                  Showing {{ displayedPromotionsCount().start }} - {{ displayedPromotionsCount().end }} of {{ displayedPromotionsCount().total }} promotions
                }
                @if (deviceType() === 'mobile') {
                  Showing {{ filteredPromotions().length }} of {{ pagination().total }} promotions
                }
              </div>
            </div>
          }
        }
      </div>
    </div>
  </main>
</div>