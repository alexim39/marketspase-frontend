<div class="dashboard-container">
  @if (isMobile()) {
    <mat-toolbar class="mobile-header">
      <button mat-icon-button (click)="toggleSidenav()">
        <mat-icon>menu</mat-icon>
      </button>
      <div class="mobile-logo">
        <img class="logo-icon" src="/img/platform_mobile_logo.jpg" alt="MarketSpase logo">
        <span class="logo-text">MarketSpase</span>
      </div>
      <div class="mobile-actions">
        <app-notification-bell [user]="user"/>
        <button mat-icon-button (click)="openCartDialog()">
          <img [src]="user()!.avatar" class="avatar-sm" [alt]="user()!.displayName"> 
          <mat-icon>arrow_drop_down</mat-icon>
        </button>
      </div>
    </mat-toolbar>
  }

  <mat-sidenav-container class="sidenav-container" [hasBackdrop]="isMobile()">
    <mat-sidenav #sidenav [mode]="isMobile() ? 'over' : 'side'" [opened]="!isMobile()" class="sidenav">
      @if (!isMobile()) {
        <div class="sidenav-header">
          <div class="logo-section">
            <img class="logo-icon" src="/img/platform_mobile_logo.jpg" alt="MarketSpase logo">
            <h1 class="logo-text">MarketSpase</h1>
          </div>
        </div>
      }

      <app-user-profile-card [user]="user" (switchUser)="switchUser($event)"/>

      <app-sidenav-navigation 
        [navigationItems]="navigationItems()" 
        (navItemClick)="isMobile() && sidenav.close()"
        (modalAction)="handleModalAction($event)"
      />

      <app-quick-actions [user]="user" 
        (createCampaign)="createCampaign()"
        (fundWallet)="fundWallet()"
        (viewPromotion)="viewPromotion()"
        (viewMyPromotion)="viewMyPromotion()"
        (switchUser)="switchUser($event)"
        (logout)="logout()"
        (mobileAction)="isMobile() && sidenav.close()"
      />
    </mat-sidenav>

    <mat-sidenav-content class="main-content">
      @if (!isMobile()) {
        <mat-toolbar class="desktop-header">
          <span class="page-title">{{getPageTitle()}}</span>
          <div class="header-spacer"></div>
          <div class="header-actions">
            <div class="wallet-display" (click)="openWallet()">
              <mat-icon>account_balance_wallet</mat-icon>
              @if (user()!.role === 'promoter') {
                <span class="wallet-amount">{{user()?.wallets?.promoter?.balance || 0 | currencyUtils:user()?.wallets?.promoter?.currency}}</span>
              }
              @if (user()!.role === 'marketer') {
                <span class="wallet-amount">{{user()?.wallets?.marketer?.balance || 0 | currencyUtils:user()?.wallets?.marketer?.currency}}</span>
              }
            </div>

            <app-notification-bell [user]="user"/>

            <button mat-icon-button (click)="openCartDialog()">
              <img [src]="user()!.avatar" class="avatar-sm" [alt]="user()?.displayName">
              <mat-icon>arrow_drop_down</mat-icon>
            </button>
          </div>
        </mat-toolbar>
      }

      <router-outlet/>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>

<ng-template #cartDialogTemplate>
  <app-cart-dialog
    [user]="user"
    [activeTab]="activeTab"
    [pendingCampaignsCount]="pendingCampaignsCount"
    [pendingPromotionsCount]="pendingPromotionsCount"
    [activeCampaignsCount]="activeCampaignsCount"
    (setActiveTab)="setActiveTab($event)"
    (closeDialog)="closeCartDialog()"
    (viewAllCampaigns)="closeCartDialog(); viewAllCampaigns()"
    (viewAllPromotions)="closeCartDialog(); viewAllPromotion()"
    (viewWithdrawal)="closeCartDialog(); viewWithdrawl()"
    (switchUser)="closeCartDialog(); switchUser($event)"
  />
</ng-template>