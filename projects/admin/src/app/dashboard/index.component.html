@if (loadingService.isLoading$ | async) {
    <mat-progress-bar mode="indeterminate"/>
}

<div class="admin-dashboard">
    <!-- Sidebar -->
    <aside class="sidebar" [class.collapsed]="sidebarCollapsed()">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <mat-icon>sync</mat-icon>
                </div>
                <span class="logo-text">MarketSpase Admin</span>
            </div>
            <button class="sidebar-toggle" (click)="toggleSidebar()">
                <mat-icon>{{ sidebarCollapsed() ? 'chevron_right' : 'chevron_left' }}</mat-icon>
            </button>
        </div>
        
        <nav class="nav-menu">
            @for (menuItem of menuItems(); track menuItem.id) {
                <!-- Parent Menu Items -->
                <div 
                    class="nav-item"
                    [class.active]="isActiveOrChildActive(menuItem)"
                    (click)="toggleMenuItem(menuItem)">
                    <div class="nav-item-content">
                        <mat-icon>{{ menuItem.icon }}</mat-icon>
                        <span>{{ menuItem.title }}</span>
                        @if (menuItem.children) {
                            <mat-icon class="nav-item-chevron" [class.expanded]="menuItem.isExpanded">
                                expand_more
                            </mat-icon>
                        }
                    </div>
                </div>
                
                <!-- Submenu Items -->
                @if (menuItem.children && menuItem.isExpanded) {
                    <div class="submenu" [class.expanded]="menuItem.isExpanded">
                        @for (childItem of menuItem.children; track childItem.id) {
                            <a
                                class="submenu-item"
                                [class.active]="activeNavItem() === childItem.id"
                                (click)="setActiveNavItem(childItem.id); $event.stopPropagation()"
                                [routerLink]="childItem.route"
                                routerLinkActive="active"
                                [routerLinkActiveOptions]="{exact: true}">
                                <mat-icon>{{ childItem.icon }}</mat-icon>
                                <span>{{ childItem.title }}</span>
                            </a>
                        }
                    </div>
                }
            }
            
            <!-- Logout Item (always visible) -->
            <div 
                class="nav-item" 
                [class.active]="activeNavItem() === 'logout'"
                (click)="logout()">
                <div class="nav-item-content">
                    <mat-icon>logout</mat-icon>
                    <span>Sign out</span>
                </div>
            </div>
        </nav>
        
        <div class="admin-profile">
            <div class="admin-avatar">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2NjdFRUEiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI4IiB5PSI4Ij4KPHBhdGggZD0iTTIwIDIxVjE5QTQgNCAwIDAgMCAxNiAxNUg4QTQgNCAwIDAgMCA0IDE5VjIxIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo8L3N2Zz4K" alt="Admin">
            </div>
            <div class="admin-info">
                <div class="admin-name">{{ adminService.adminData()?.name || 'Admin' }}</div>
                <div class="admin-role">{{ adminService.adminData()?.role || 'User' }}</div>
            </div>
        </div>
    </aside>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="page-title">{{ pageTitle() }}</h1>
                <div class="breadcrumb">{{ currentDate }}</div>
            </div>
            
            <div class="header-right">
                <div class="search-container">
                    <mat-icon class="search-icon">search</mat-icon>
                    <input 
                        type="text" 
                        placeholder="Search..."
                        class="search-input"
                        [value]="searchQuery()"
                        (input)="onSearchInput($event)">
                </div>
                
                <div class="header-actions">
                    <button class="notification-btn" [class.has-notifications]="notificationCount() > 0">
                        <mat-icon>notifications</mat-icon>
                        @if (notificationCount() > 0) {
                            <span class="notification-badge">{{ notificationCount() }}</span>
                        }
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Dynamic Content Area -->
        <router-outlet></router-outlet>
    </div>
</div>