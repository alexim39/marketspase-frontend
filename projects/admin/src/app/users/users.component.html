<div class="admin-users-container">
    <!-- Header Section -->
    <div class="header-section">
    <h1 class="page-title">User Management</h1>
    <p class="page-subtitle">Manage all users of the platform</p>
    </div>

    <!-- Filters Card -->
    <mat-card class="filters-card">
    <mat-card-content>
        <div class="filters-container">
        <mat-form-field appearance="outline" class="filter-field search-field">
            <mat-label>Search Users</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Search by name, email, username" #input>
            <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        </div>
    </mat-card-content>
    </mat-card>

    <!-- Users Table -->
    <mat-card class="table-card">
    <mat-card-content>
        <div class="table-container">
        @if (isLoading) {
            <div class="loading-spinner">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Loading users...</p>
            </div>
        } @else {
            <table mat-table [dataSource]="dataSource" matSort class="users-table">
            <!-- Avatar Column -->
            <ng-container matColumnDef="avatar">
                <th mat-header-cell *matHeaderCellDef> </th>
                <td mat-cell *matCellDef="let user">
                <img [src]="user.avatar" alt="User avatar" class="user-avatar">
                </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="displayName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                <td mat-cell *matCellDef="let user">
                <div class="user-info">
                    <span class="user-name">{{ user.displayName }}</span>
                    <span class="user-username">@{{ user.username }}</span>
                </div>
                </td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
                <td mat-cell *matCellDef="let user" class="email-cell">
                {{ user.email }}
                </td>
            </ng-container>

            <!-- Role Column -->
            <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Currently </th>
                <td mat-cell *matCellDef="let user">
                <mat-chip [class]="user.role" class="role-chip">
                    {{ user.role }}
                </mat-chip>
                </td>
            </ng-container>

            <!-- Balance Column -->
            <ng-container matColumnDef="balance">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Balance </th>
                <td mat-cell *matCellDef="let user">
                <div class="balance-info">
                    <span class="balance-amount">
                    {{ user.role === 'marketer' ? (user.wallets.marketer.balance | currency:'NGN':'₦') : (user.wallets.promoter.balance | currency:'NGN':'₦') }}
                    </span>
                </div>
                </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                <td mat-cell *matCellDef="let user">
                <div class="status-container">
                    <mat-chip 
                    [class.active]="user.isActive && !user.isDeleted" 
                    [class.inactive]="!user.isActive && !user.isDeleted"
                    [class.deleted]="user.isDeleted"
                    class="status-chip">
                    {{ user.isDeleted ? 'Deleted' : (user.isActive ? 'Active' : 'Inactive') }}
                    </mat-chip>
                    <mat-chip class="verification-chip" *ngIf="user.isVerified && !user.isDeleted">
                    Verified
                    </mat-chip>
                </div>
                </td>
            </ng-container>

            <!-- Joined Column -->
            <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Joined </th>
                <td mat-cell *matCellDef="let user">
                {{ user.createdAt | date:'mediumDate' }}
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let user">
                <div class="action-buttons">
                    <button mat-icon-button 
                            matTooltip="View Details"
                            (click)="viewUserDetails(user)">
                    <mat-icon>visibility</mat-icon>
                    </button>

                    <!--  <button mat-icon-button 
                            matTooltip="{{ user.isActive ? 'Deactivate' : 'Activate' }}"
                            (click)="user.isActive ? deactivateUser(user) : activateUser(user)" 
                            [disabled]="user.isDeleted">
                    <mat-icon>{{ user.isActive ? 'toggle_off' : 'toggle_on' }}</mat-icon>
                    </button> -->
                    
                </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <!-- Row shown when there's no matching data -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell no-data" [attr.colspan]="displayedColumns.length">
                No users found matching "{{ input.value }}"
                </td>
            </tr>
            </table>
        }
        </div>

        <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons/>
    </mat-card-content>
    </mat-card>
</div>